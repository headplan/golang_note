# 变量的声明周期

变量的生命周期指的是在程序运行期间变量有效存在的时间间隔 .

变量的生命周期与变量的作用域有着不可分割的联系 :

* 全局变量 : 它的生命周期和整个程序的运行周期是一致的
* 局部变量：它的生命周期则是动态的 , 从创建这个变量的声明语句开始 , 到这个变量不再被引用为止
* 形式参数和函数返回值 : 它们都属于局部变量 , 在函数被调用的时候创建 , 函数调用结束后被销毁

```go
for t := 0.0; t < cycles*2*math.Pi; t += res {
    x := math.Sin(t)
    y := math.Sin(t*freq + phase)
    img.SetColorIndex(
        size+int(x*size+0.5), size+int(y*size+0.5),
        blackIndex, // 最后插入的逗号不会导致编译错误,这是Go编译器的一个特性
    )               // 小括号另起一行缩进,和大括号的风格保存一致
}
```

上面代码中 , 在每次循环的开始会创建临时变量 t , 然后在每次循环迭代中创建临时变量 x 和 y . 临时变量 x、y 存放在栈中 , 随着函数执行结束\(执行遇到最后一个`}`\) , 释放其内存 . 

栈的概念在前面说过 , 它和堆的区别在于 : 

* 堆\(heap\) : 堆是用于存放进程执行中被动态分配的内存段 . 它的大小并不固定 , 可动态扩张或缩减 . 当进程调用 malloc 等函数分配内存时 , 新分配的内存就被动态加入到堆上\(堆被扩张\) . 当利用 free 等函数释放内存时 , 被释放的内存从堆中被剔除\(堆被缩减\) ; 
* 栈\(stack\) : 栈又称堆栈 , 用来存放程序暂时创建的局部变量 , 也就是我们函数的大括号`{}`中定义的局部变量 . 

在程序的编译阶段 , 编译器会根据实际情况自动选择在栈或者堆上分配局部变量的存储空间 , 不论使用var还是new关键字声明变量都不会影响编译器的选择 . 

```go
var global *int
func f() {
    var x int
    x = 1
    global = &x
}
func g() {
    y := new(int)
    *y = 1
}
```



