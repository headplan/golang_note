# goroutine之间通信的管道

如果说 goroutine 是 Go语言程序的并发体的话 , 那么 channels 就是它们之间的通信机制 . 一个 channels 是一个通信机制 , 它可以让一个 goroutine 通过它给另一个 goroutine 发送值信息 . 每个 channel 都有一个特殊的类型 , 也就是 channels 可发送数据的类型 . 一个可以发送 int 类型数据的 channel 一般写为 chan int .

Go语言提倡使用通信的方法代替共享内存 , 当一个资源需要在 goroutine 之间共享时 , 通道在 goroutine 之间架起了一个管道 , 并提供了确保同步交换数据的机制 . 声明通道时 , 需要指定将要被共享的数据的类型 . 可以通过通道共享内置类型、命名类型、结构类型和引用类型的值或者指针 .

![](/assets/goroutineandchannel.png)

在地铁站、食堂、洗手间等公共场所人很多的情况下 , 大家养成了排队的习惯 , 目的也是避免拥挤、插队导致的低效的资源使用和交换过程 . 代码与数据也是如此 , 多个 goroutine 为了争抢数据 , 势必造成执行的低效率 , 使用队列的方式是最高效的 , channel 就是一种队列一样的结构 .

#### 通道的特性

Go语言中的通道\(channel\)是一种特殊的类型 . 在任何时候 , 同时只能有一个 goroutine 访问通道进行发送和获取数据 . goroutine 间通过通道就可以通信 .

通道像一个传送带或者队列 , 总是遵循先入先出\(First In First Out\)的规则 , 保证收发数据的顺序 .

#### 声明通道类型

通道本身需要一个类型进行修饰 , 就像切片类型需要标识元素类型 . 通道的元素类型就是在其内部传输的数据类型 , 声明如下 :

```
var 通道变量 chan 通道类型
```

* 通道类型 : 通道内的数据类型 . 
* 通道变量 : 保存通道的变量 . 

chan 类型的空值是 nil , 声明后需要配合 make 后才能使用 .

#### 创建通道

通道是引用类型 , 需要使用 make 进行创建 , 格式如下 :

```
通道实例 := make(chan 数据类型)
```

* 数据类型 : 通道内传输的元素类型 . 
* 通道实例 : 通过make创建的通道句柄 . 

```go
ch1 := make(chan int)              // 创建一个整型类型的通道
ch2 := make(chan interface{})      // 创建一个空接口类型的通道,可以存放任意格式
type Equip struct{ /* 一些字段 */ }
ch2 := make(chan *Equip)           // 创建Equip指针类型的通道,可以存放*Equip
```

#### 使用通道发送数据

通道创建后 , 就可以使用通道进行发送和接收操作 . 

##### 通道发送数据的格式

通道的发送使用特殊的操作符`<-`, 将数据通过通道发送的格式为 : 

```go
通道变量 <- 值
```



