# 工作区和GOPATH

#### 安装Go需要配置的三个环境变量 :

* GOROOT : Go语言安装根目录的路径 , 也就是Go语言的安装路径 .
* GOPATH : 若干工作区目录的路径 , 是我们自己定义的工作空间 .
* GOBIN : GO程序生成的可执行文件的路径 . \(executable file\)

### 重点关注GOPATH

* **GOPATH**可以简单的理解成Go语言的工作目录 , 它的值是一个目录的路径 , 也可以是多个目录路径 , **每个目录都代表Go语言的一个工作区\(workspace\)** .
* 利用这些工作区放置Go语言的**源码文件\(source file\)** , 已经安装后的**归档文件**\(archive file , 也就是以.a为扩展名的文件\)和**可执行文件**\(executable file\) .
* Go语言项目在其生命周期内的所有操作 , 编码 , 依赖管理 , 构建 ,测试 , 安装等 , 基本都围绕着GOPATH和工作区进行 .

根据对GOPATH的描述 , 引出了三个问题 :

* **Go语言源码的组织方式是怎样的?**
* **源码安装后的结果 ? \(只有在安装后 , Go语言源码才能被我们或其他代码使用\)**
* **构建和安装Go程序的过程 ? \(这在开发程序以及查找程序问题的时候很有用\)**

#### **源码的组织方式**

Go语言的源码以**代码包**为基本组织单位 . **在文件系统中代码包与目录对应** , 目录可以有子目录 , 所以代码包也有子包 .

代码包中包含任意个.go为扩展名的源码文件 , 源码文件都需要被声明属于同一个代码包 .

```go
package test
```

**通常代码包的名称会与源文件所在目录同名 , 如果不同的话 , 在构建 , 安装的过程中会以代码包名称为准 .**

每个代码包都会有导入路径 . **代码包的导入路径是其他代码在使用该包中的程序实体时** , 需要引入的路径 . 就是import一下 :

```
import "github.com/labstack/echo"
```

通常在工作区中 , 代码包的导入路径实际上就是**从src子目录到包的实际存储位置的相对路径** .

总结 , Go语言源码的组织方式就是以环境变量GOPATH , 工作区 , src目录和代码包为主线的 . 源码文件都会放在环境变量GOPATH包含的某个工作区中的src目录下的某个代码包中 .

#### **源码安装后的结果**

源码安装后产生了**归档**文件\(以.a为扩展名的文件\) , 就会放进该工作区的**pkg**子目录 , 如果产生了可执行文件 , 没设置**bin**目录的话会放进该工作区的bin子目录 .

##### 归档文件存放的位置和规则

安装代码包产生的归档文件与代码包同名 , 放置目录就是代码包导入路径的直接父级 .

例如 , 一个已存在的代码包的导入路径 :

```
github.com/labstack/echo
```

执行命令

```
go install github.com/labstack/echo
```

生成的归档文件相对目录就是github.com/labstack , 文件名echo.a . 顺便说一下 , 这个代码包导入路径也表示 , 代码包的源码文件在Github上labstack组的代码仓库echo中 .

归档文件的相对目录与pkg目录之间还有一级目录 , 叫平台相关目录 . 平台相关目录的名称是由build的目标操作系统 , 下划线和目标计算机架构的代号组成的 . 例如 , linux\_amd64 .

![](/assets/guidangwenjian.png)

总之 , 某个工作区的src子目录下的源码文件安装后一般放在pkg或bin中 .

#### **构建和安装Go程序的过程**

构建命令使用`go build` , 安装命令使用`go install` . 构建和安装代码包的时候都会执行编译 , 打包等操作 , 并且 , 这些操作生成的任何文件都会被保存到某个临时目录中 .

##### **构建**

* 如果构建的是库源码文件 , 那么操作后产生的结果文件只会存在于临时目录中 . 这里的构建的主要意义在于检查和验证 . 
* 如果构建的是命令源码文件 , 那么操作的结果文件会被搬运到源码文件所在的目录中 . 

##### 安装

安装操作会先执行构建 , 然后还会进行链接操作 , 并且把结果文件搬运到指定目录 .

* 如果安装的是库源码文件 , 那么结果文件会被搬运到它所在工作区的 pkg 目录下的某个子目录中
* 如果安装的是命令源码文件 , 那么结果文件会被搬运到它所在工作区的 bin 目录中 , 或者环境变量GOBIN指向的目录中



